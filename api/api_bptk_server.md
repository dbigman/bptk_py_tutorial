---
title: BptkServer
description: BPTK API Documentation for the BptkServer class
keywords: system dynamics, agent-based modeling, flask, REST, bptk, bptk-py, python, business prototyping
---



# BptkServer

The `BptkServer` class provides a REST-API using the Flask framework.

It is essentially a wrapper around the bptk class that forwards REST API calls to bptk.

You will typically start the framework by instantiating the `bptk` class within a Jupyer notebook, as follows:

```default
from BPTK_Py.server import BptkServer
from flask_cors import CORS

from model import bptk # assuming your model is in a file called model.py that sets up bptk

# Calling the BptkServer class
application = BptkServer(__name__, bptk)
CORS(application)

if __name__ == "__main__":
   application.run()
```

Assuming you save that code in a file called application.py, you can then start the server fro the command line as follows:

```default
export FLASK_ENV=development
export FLASK_APP=application.py
python -m flask run
```

The server is now available on port 5000 and you can call the endpoints documented below.

Our [Core Concepts](/concepts/concepts.ipynb) section contains a notebook that provides an [Introduction to BptkServer](/concepts/bptk_server/bptk_server_intro.ipynb)

## BptkServer Constructor

**BptkServer(import_name, bptk_factory=None, external_state_adapter=None, bearer_token=None)**

This class provides a Flask-based server that provides a REST-API for running bptk scenarios. The class inherts the properties and methods of Flask and doesn’t expose any further public methods.

## agents

**POST /agents**

For an agent-based or hybrid model, this endpoint returns all the agents in the model with their corresponding states and properties.

## begin-session

**POST /{instance_uuid}/begin-session**

This endpoint starts a session for single step simulation. There can only be one session per instance at a time.

## end-ession 

**POST /{instance_uuid}/end-session**

This endpoint ends a session for single step simulation and resets the internal cache.

## equations

**POST /equations**

This endpoint returns all available equations given the name of a scenario manager and of a scenario.

## flat-session-results

**GET /{instance_uuid}/flat-session-results**

Returns the accumulated results of a session, from the first step to the last step that was run in a flat format.

## full-metrics

**GET /full-metrics**

Returns metrics in JSON format. This endpoint is unprotected.

The following metrics are returned:
- Instance count
- Creation time und current timestep of each instance

## healthy

**GET /healthy**

Unprotected endpoint useful for health checks, e.g. when running as a Kubernetes pod. It simply returns a HTTP 200 response and doesn't interact with the bptk factory.

## keep-alive

**POST /{instance_uuid}/keep-alive**
This endpoint sets the “last accessed time” of the instance to the current time to prevent the instance from timeing out.

Arguments: None

## load-state

**GET /load-state**

Loads all instances using the external state adapter

## root

**GET /**

The root endpoint returns a simple html page that can be used for test purposes. The root endpoint is unprotected even if bearer token authorization is turned on.


## run-step

**POST /{instance_uuid}/run-step**

This endpoint advances the relevant scenarios by one timestep and returns the data for that timestep.

Arguments:

    instance_uuid: string

        The id of the instance to advance.


## run-steps

**POST /{instance_uuid}/run-steps**

This endpoint advances the relevant scenarios by one timestep and returns the data for that timestep.

Arguments:

    instance_uuid: string

        The id of the instance to advance.

## session-results

**GET /{instance_uuid}/session-results**

Returns the accumulated results of a session, from the first step to the last step that was run.


## metrics

**GET /metrics**

Returns metrics in a [Prometheus](https://prometheus.io) compatible format. This endpoint is unprotected.

## run

**POST /run**

Given a JSON dictionary that defines the relevant simulation scenarios and equations, this endpoint runs those scenarios and returns the data generated by the simulations.

## save-state

**GET /save-state**

Save all instances with the provided external state adapter.

## scenarios

**GET /scenarios**

The endpoint returns all available scenarios for the current simulation.
## start-instance

**POST /start-instance**

This endpoint starts a new instance of BPTK on the server side, so that simulations can run in a “private” session. The endpoint returns an instance_id, which is needed to identify the instance in later calls.

* __Arguments:__ 

    * __timeout (dict,optional).__ The timeout period after which the instance is delete if it is not accessed in the meantime. The timer is reset every time the instance is accessed. The timeout dictionary can have the following keys: weeks, days, hours, minutes, seconds, milliseconds, microseconds. Values must be integers.

## stream-steps

**POST /{instance_uuid}/stream-steps**

This endpoint is used to stream a simulation. This is useful for long-running simulations, the result of each simulation step is streamed accross the API:

Arguments:

> instance_uuid: string

>     The id of the instance to stream.
