<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.267">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="keywords" content="system dynamics, systemdynamics, sd dsl, xmile, bptk, bptk-py, python, business simulation">
<meta name="description" content="Introduction to the python library for system dynamics, that is part of the BPTK-Py business simulation framework.">

<title>BPTK_PY - A Simple Python Library For System Dynamics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../sd-dsl/in-depth/in_depth_sd_dsl_functions/in_depth_sd_dsl_functions.html" rel="next">
<link href="../../../step-by-step-guides/introduction_sd_dsl/introduction_sd_dsl.html" rel="prev">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
<meta property="og:title" content="BPTK_PY - A Simple Python Library For System Dynamics">
<meta property="og:description" content="Introduction to the python library for system dynamics, that is part of the BPTK-Py business simulation framework.">
<meta property="og:site-name" content="BPTK_PY">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">A Simple Python Library For System Dynamics</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../../">BPTK_PY</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/installation.html" class="sidebar-item-text sidebar-link">Installation</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/quickstart.html" class="sidebar-item-text sidebar-link">Quickstart</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/limitations.html" class="sidebar-item-text sidebar-link">Limitations</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../general/general.html" class="sidebar-item-text sidebar-link">General Information</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../general/in-depth/in_depth_bptk_py_architecture/in_depth_bptk_py_architecture.html" class="sidebar-item-text sidebar-link">Architecture</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../general/in-depth/in_depth_scenarios/in_depth_scenarios.html" class="sidebar-item-text sidebar-link">Scenarios in Depth</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../general/how-to/how_to_accessing_raw_simulation_results/how_to_accessing_raw_simulation_results.html" class="sidebar-item-text sidebar-link">Accessing Raw Simulation Results</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../general/how-to/how_to_advanced_plotting_features/how_to_advanced_plotting_features.html" class="sidebar-item-text sidebar-link">Advanced Plotting Features</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../general/how-to/how_to_develop_dashboards_using_jupyter_widgets/how_to_developing_dashboards_using_juypter_widgets.html" class="sidebar-item-text sidebar-link">Dashboards using Jupyter Widgets</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../general/how-to/how_to_develop_dashboards_using_simpledashboard/how_to_develop_dashboards_using_simpledashboard.html" class="sidebar-item-text sidebar-link">Dashboards using the SimpleDashboard</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../general/how-to/how_to_external_state/how_to_external_state.html" class="sidebar-item-text sidebar-link">Persistent BPTK-Server State</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../abm/abm.html" class="sidebar-item-text sidebar-link">Agent Based Modeling</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../abm/in-depth/in_depth_agent_based_modeling/in_depth_agent_based_modeling.html" class="sidebar-item-text sidebar-link">Agent Based Modeling</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../abm/how-to/how_to_choose_datacollector/how_to_choose_datacollector.html" class="sidebar-item-text sidebar-link">Data Collector</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../xmile/xmile.html" class="sidebar-item-text sidebar-link">Introduction to XMILE</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../xmile/how-to/how_to_working_with_XMILE/how_to_working_with_XMILE.html" class="sidebar-item-text sidebar-link">XMILE SD Models</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../xmile/how-to/how_to_exporting_simulation_results/how_to_exporting_simulation_results.html" class="sidebar-item-text sidebar-link">Exporting Simulation Results</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../xmile/how-to/how_to_xmile_arrays/how_to_xmile_arrays.html" class="sidebar-item-text sidebar-link">Arrayed Variables in XMILE Models</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../xmile/how-to/how_to_use_sd_compiler_standalone/how_to_use_sd_compiler_standalone.html" class="sidebar-item-text sidebar-link">Use Standalone XMILE Compiler</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../xmile/in-depth/writing_computational_essays/writing_computational_essays.html" class="sidebar-item-text sidebar-link">Writing Computational Essays</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../../../sd-dsl/sddsl.html" class="sidebar-item-text sidebar-link">Introduction to SD DSL</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../step-by-step-guides/introduction_sd_dsl/introduction_sd_dsl.html" class="sidebar-item-text sidebar-link">Introduction to SD DSL</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../sd-dsl/in-depth/in_depth_simple_python_library_sd_dsl/in_depth_simple_python_library_sd_dsl.html" class="sidebar-item-text sidebar-link active">BPTK for System Dynamics</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../sd-dsl/in-depth/in_depth_sd_dsl_functions/in_depth_sd_dsl_functions.html" class="sidebar-item-text sidebar-link">SD DSL Functions</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../sd-dsl/how-to/how_to_sd_user_defined_functions/how_to_sd_user_defined_functions.html" class="sidebar-item-text sidebar-link">User-defined functions</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#a-simple-python-library-for-system-dynamics" id="toc-a-simple-python-library-for-system-dynamics" class="nav-link active" data-scroll-target="#a-simple-python-library-for-system-dynamics">A Simple Python Library For System Dynamics</a>
  <ul class="collapse">
  <li><a href="#build-system-dynamics-simulations-interactively-in-jupyter-using-python" id="toc-build-system-dynamics-simulations-interactively-in-jupyter-using-python" class="nav-link" data-scroll-target="#build-system-dynamics-simulations-interactively-in-jupyter-using-python">Build System Dynamics simulations interactively in Jupyter using Python</a>
  <ul class="collapse">
  <li><a href="#a-simple-model-to-demonstrate-the-library" id="toc-a-simple-model-to-demonstrate-the-library" class="nav-link" data-scroll-target="#a-simple-model-to-demonstrate-the-library">A simple model to demonstrate the library</a></li>
  </ul></li>
  <li><a href="#storing-models-created-using-the-sd-dsl-in-a-python-class" id="toc-storing-models-created-using-the-sd-dsl-in-a-python-class" class="nav-link" data-scroll-target="#storing-models-created-using-the-sd-dsl-in-a-python-class">Storing Models Created Using The SD DSL In A Python Class</a>
  <ul class="collapse">
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">A Simple Python Library For System Dynamics</h1>
</div>

<div>
  <div class="description">
    Introduction to the python library for system dynamics, that is part of the BPTK-Py business simulation framework.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="a-simple-python-library-for-system-dynamics" class="level1">
<h1>A Simple Python Library For System Dynamics</h1>
<section id="build-system-dynamics-simulations-interactively-in-jupyter-using-python" class="level2">
<h2 class="anchored" data-anchor-id="build-system-dynamics-simulations-interactively-in-jupyter-using-python">Build System Dynamics simulations interactively in Jupyter using Python</h2>
<p>We love building computational models and our favorite environment for this kind of explorative, analytical work are <a href="http://www.jupyter.org">Jupyter</a> and <a href="http://www.python.org">Python</a>.</p>
<p>To make computational modeling easier we are developing the <em>Business Prototyping Toolkit for Python</em> (BPTK PY), a simple library that currently supports System Dynamics and Agent-based modeling.</p>
<p>We first introduced the BPTK PY libary in our recent post <a href="https://www.transentis.com/writing-computational-essays-based-simulation-models/">Writing Computational Essays Based On Simulation Models</a>.</p>
<p>Since then we’ve created some new functionality that allows you to build System Dynamics models and Agent-based models interactively in Jupyter using Python. To make model building as simple as possible, we have created a simple, domain-specific language (DSL) that supports both System Dynamics and Agent-based modeling and hides much of the underlying complexity of computational models.</p>
<p>This language not only allows you to create System Dynamics models and Agent-based models, you can even mix the two to create “hybrid” simulation models.</p>
<p>Having such a DSL is useful for several reasons:</p>
<ul>
<li>Build models interactively in Jupyter, making the modeling process very effective.</li>
<li>Python novices can focus on the modeling, without needing to know much about Python</li>
<li>Python experts can mix their models with other analytical frameworks, e.g.&nbsp;machine-learning toolkits.</li>
</ul>
<p>Needless to say the new functionality seamlessly integrates with the rest of the BPTK PY framework, so you can use all the high-level scenario management and plotting functions which are part of the framework.</p>
<p>In this post I focus on how to build a System Dynamics model using the framework, I will take a look at Agent-based modeling in a future post.</p>
<section id="a-simple-model-to-demonstrate-the-library" class="level3">
<h3 class="anchored" data-anchor-id="a-simple-model-to-demonstrate-the-library">A simple model to demonstrate the library</h3>
<p>To illustrate the DSL, we will build the simple project management model we introduced in our <a href="https://www.transentis.com/step-by-step-tutorials/introduction-to-system-dynamics/">step-by-step tutorial on System Dynamics</a>.</p>
<p>The project management model is really simple and just containts a few stocks, flows and converters, as you can see in the following diagram:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="simple_project_diagram.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Diagram of the Simple Project Management Model</figcaption><p></p>
</figure>
</div>
<p>So even if you don’t know the model you should be able to follow this post very easily.</p>
<p>To get started, we first need to import the library and in particular the SD function library into our notebook.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> BPTK_Py <span class="im">import</span> Model</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> BPTK_Py <span class="im">import</span> sd_functions <span class="im">as</span> sd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The SD function library contains the functions and operators needed to define model equations (these are the built-ins you will know from your visual modeling environment, such as Stella or Vensim). Because the library contains functions such as <code>min</code> and <code>max</code>, which are also part of the Python standard library, we import the SD function library with the prefix <code>sd</code> to avoid naming conflicts.</p>
<p>Next we create a model using the <code>Model</code> class. Our model will contain all our model elements such as stocks, flows, converters and constants.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> Model(starttime<span class="op">=</span><span class="fl">0.0</span>,stoptime<span class="op">=</span><span class="fl">120.0</span>,dt<span class="op">=</span><span class="fl">1.0</span>,name<span class="op">=</span><span class="st">'SimpleProjectManagament'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Creating model elements is really easy:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>openTasks <span class="op">=</span> model.stock(<span class="st">"openTasks"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As you can see our convention is to use the camel casing naming convention for the model elements and to create Python variables for the elements that carry the same name.</p>
<p>Once a model element has been defined in this manner, we only need to refer to the Python variable and don’t need to reference the model element (i.e.&nbsp;we can use <code>openTasks</code> in our equations, as opposed to using <code>model.stock("openTasks")</code>. This saves a lot of typing.</p>
<p>Let’s define the other model elements and variables now too, so that we can then concentrate on the equations:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>closedTasks <span class="op">=</span> model.stock(<span class="st">"closedTasks"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>staff <span class="op">=</span> model.stock(<span class="st">"staff"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>completionRate <span class="op">=</span> model.flow(<span class="st">"completionRate"</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>currentTime <span class="op">=</span> model.converter(<span class="st">"currentTime"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>remainingTime <span class="op">=</span> model.converter(<span class="st">"remainingTime"</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>schedulePressure <span class="op">=</span> model.converter(<span class="st">"schedulePressure"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>productivity <span class="op">=</span> model.converter(<span class="st">"productivity"</span>)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>deadline <span class="op">=</span> model.constant(<span class="st">"deadline"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>effortPerTask <span class="op">=</span> model.constant(<span class="st">"effortPerTask"</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>initialStaff <span class="op">=</span> model.constant(<span class="st">"initialStaff"</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>initialOpenTasks <span class="op">=</span> model.constant(<span class="st">"initialOpenTasks"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that in our models we differentiate between <em>constants</em> and <em>converters</em> – this isn’t strictly necessary from a System Dynamics point of view, but it makes it easier to check the model for errors.</p>
<p>Now let’s initialize our stocks - to do this, we just need to set the <code>initial_value</code> property of the stocks. The initial value can either be a numerical constant or a constant element.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>closedTasks.initial_value <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>staff.initial_value <span class="op">=</span> initialStaff</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>openTasks.initial_value <span class="op">=</span> initialOpenTasks </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Defining the model equations is really easy: each model variable has an <code>equation</code> property, the equation itself is written much like you would in a visual modeling environment, using the other model variables as necessary.</p>
<p>Defining constants is particularly easy:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>deadline.equation <span class="op">=</span> <span class="fl">100.0</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>effortPerTask.equation <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>initialStaff.equation <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>initialOpenTasks.equation <span class="op">=</span> <span class="fl">100.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>currentTime</code> variable tracks the simulation time, which is captured by the <code>time</code> function in the SD function library.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>currentTime.equation<span class="op">=</span>sd.time()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>remainingTime</code> equals the difference between the <code>deadline</code> and the <code>currentTime</code>:</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>remainingTime.equation <span class="op">=</span> deadline <span class="op">-</span> currentTime</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So you see, thanks to the DSL defining equations is very intuitive!</p>
<p>The equations for the stocks are also really simple - they just contain the inflows (with a positive sign) and the outflows (with a negative sign).</p>
<p>A quick look at the diagram above tells us that the <code>openTasks</code> only have an outflow (defined by the <code>completionRate</code>) and the <code>closedTasks</code> only have an inflow (also defined by the <code>completionRate</code>):</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>openTasks.equation <span class="op">=</span> <span class="op">-</span>completionRate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>closedTasks.equation <span class="op">=</span> completionRate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>schedulePressure</code> is a dimensionless ratio that compares the required effort to complete all remaining open tasks to the remaining work capacity.</p>
<p>We use the <code>min</code> and <code>max</code> functions from the SD function library to ensure that no division by zero occurs and that the schedule pressure is capped at 2.5:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>schedulePressure.equation <span class="op">=</span> sd.<span class="bu">min</span>((openTasks<span class="op">*</span>effortPerTask)<span class="op">/</span>(staff<span class="op">*</span>sd.<span class="bu">max</span>(remainingTime,<span class="dv">1</span>)),<span class="fl">2.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We define the productivity in our model using a non-linear relationship (depending on the schedule pressure). We capture this relationship in a lookup table that we store in the <code>points</code> property of the model (using a Python list):</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>model.points[<span class="st">"productivity"</span>] <span class="op">=</span> [</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>,<span class="fl">0.4</span>],</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.25</span>,<span class="fl">0.444</span>],</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.5</span>,<span class="fl">0.506</span>],</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.75</span>,<span class="fl">0.594</span>],</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">1</span>,<span class="dv">1</span>],</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.25</span>,<span class="fl">1.119</span>],</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.5</span>,<span class="fl">1.1625</span>],</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">1.75</span>,<span class="fl">1.2125</span>],</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">2</span>,<span class="fl">1.2375</span>],</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.25</span>,<span class="fl">1.245</span>],</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">2.5</span>,<span class="fl">1.25</span>]</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can easily plot the lookup table to see whether it has the right shape:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>model.plot_lookup(<span class="st">"productivity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The productivity equation is then defined via a lookup function – in our case <code>productivity</code> depends non-linearly on <code>schedulePressure</code> as defined in the lookup table:</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>productivity.equation <span class="op">=</span> sd.lookup(schedulePressure,<span class="st">"productivity"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The last equation we need to define is that of the <code>completionRate</code> - the completion rate is defined by the number of staff working on the project divided by the effort per task. We then multiply this with the (average) productivity of the staff. The completion rate may never be larger than the number of <code>openTasks</code>, so we constrain it using the <code>min</code> function.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>completionRate.equation <span class="op">=</span> sd.<span class="bu">max</span>(<span class="fl">0.0</span>, sd.<span class="bu">min</span>(openTasks, staff<span class="op">*</span>(productivity<span class="op">/</span>effortPerTask)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have defined all necessary equations, we are ready to run the model. The easist way is to evaluate a model variable at a particular timestep - this approach is particularly useful if you are building the model interactively (e.g.&nbsp;in a Jupyter notebook) and you want to test intermediate results.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>closedTasks(<span class="dv">80</span>), closedTasks(<span class="dv">100</span>), closedTasks(<span class="dv">120</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s play with different settings for the deadline:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>deadline.equation <span class="op">=</span> <span class="fl">120.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>closedTasks(<span class="dv">80</span>), closedTasks(<span class="dv">100</span>), closedTasks(<span class="dv">120</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>deadline.equation<span class="op">=</span><span class="fl">80.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>closedTasks(<span class="dv">80</span>), closedTasks(<span class="dv">100</span>), closedTasks(<span class="dv">120</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Of course we can also plot the variables in a graph straight away using the element’s <code>plot()</code> method.</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>closedTasks.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now that we have a model, we can use the powerful scenario management built into the BPTK PY framework.</p>
<p>To do that, we first need to instantiate the framework:</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> BPTK_Py</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>bptk <span class="op">=</span> BPTK_Py.bptk()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we set up a scenario manager using a Python dictionary. The scenario manager identifies the baseline constants of the model:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>scenario_manager <span class="op">=</span> {</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"smSimpleProjectManagementDSL"</span>:{</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"model"</span>: model,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"base_constants"</span>: {</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"deadline"</span>: <span class="fl">100.0</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"initialStaff"</span>: <span class="fl">1.0</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"effortPerTask"</span>: <span class="fl">1.0</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"initialOpenTasks"</span>: <span class="fl">100.0</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"base_points"</span>:{</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"productivity"</span>: [</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>                [<span class="fl">0.0</span>,<span class="fl">0.4</span>],</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>                [<span class="fl">0.25</span>,<span class="fl">0.444</span>],</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>                [<span class="fl">0.5</span>,<span class="fl">0.506</span>],</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>                [<span class="fl">0.75</span>,<span class="fl">0.594</span>],</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>                [<span class="dv">1</span>,<span class="dv">1</span>],</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>                [<span class="fl">1.25</span>,<span class="fl">1.119</span>],</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>                [<span class="fl">1.5</span>,<span class="fl">1.1625</span>],</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>                [<span class="fl">1.75</span>,<span class="fl">1.2125</span>],</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>                [<span class="dv">2</span>,<span class="fl">1.2375</span>],</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>                [<span class="fl">2.25</span>,<span class="fl">1.245</span>],</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>                [<span class="fl">2.5</span>,<span class="fl">1.25</span>]</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The scenario manager has to be registered as follows:</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>bptk.register_scenario_manager(scenario_manager)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once we have this, we can define and register (one or more) scenarios as follows:</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>bptk.register_scenarios(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    scenarios <span class="op">=</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"scenario80"</span>: {</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">"constants"</span>: {</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"initialOpenTasks"</span>: <span class="fl">80.0</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    ,</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    scenario_manager<span class="op">=</span><span class="st">"smSimpleProjectManagementDSL"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then plot the scenario as follows:</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>bptk.plot_scenarios(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    scenarios<span class="op">=</span><span class="st">"scenario80"</span>,</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    scenario_managers<span class="op">=</span><span class="st">"smSimpleProjectManagementDSL"</span>,</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    equations<span class="op">=</span><span class="st">"openTasks"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s register a few more scenarios:</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>bptk.register_scenarios(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    scenarios <span class="op">=</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">"scenario100"</span>: {</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"scenario120"</span>: {</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">"constants"</span>: {</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>                <span class="st">"initialOpenTasks"</span> : <span class="fl">120.0</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    scenario_manager<span class="op">=</span><span class="st">"smSimpleProjectManagementDSL"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>scenario100</code> is equivalent to the base settings, hence we don’t need to define any settings for it.</p>
<p>Now we can easily compare the scenarios:</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>bptk.plot_scenarios(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    scenarios<span class="op">=</span><span class="st">"scenario80,scenario100,scenario120"</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    scenario_managers<span class="op">=</span><span class="st">"smSimpleProjectManagementDSL"</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    equations<span class="op">=</span><span class="st">"openTasks"</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    series_names<span class="op">=</span>{</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"smSimpleProjectManagementDSL_scenario80_openTasks"</span>:<span class="st">"scenario80"</span>,</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"smSimpleProjectManagementDSL_scenario100_openTasks"</span>:<span class="st">"scenario100"</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"smSimpleProjectManagementDSL_scenario120_openTasks"</span>:<span class="st">"scenario120"</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="storing-models-created-using-the-sd-dsl-in-a-python-class" class="level2">
<h2 class="anchored" data-anchor-id="storing-models-created-using-the-sd-dsl-in-a-python-class">Storing Models Created Using The SD DSL In A Python Class</h2>
<p>It is possible to take the code from above and store it in a Python code file. The JSON structure is exactly as you are used to from the generated models. <a href="simulation_models/simple_project_manual.py">simulation_models/simple_project_dsl_class.py</a> is such a code file that implements the code. Let us walk through it. For readability, we omit a lot of code and only show the basic structure:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> simulation_model(Model):</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>):</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Never forget calling the super method to initialize the main parameters</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>(starttime<span class="op">=</span><span class="dv">0</span>,stoptime<span class="op">=</span><span class="dv">120</span>,dt<span class="op">=</span><span class="dv">1</span>,name <span class="op">=</span><span class="st">'SimpleProjectManagament_scenario80'</span> )</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Stocks</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>        openTasks <span class="op">=</span> <span class="va">self</span>.stock(<span class="st">"openTasks"</span>)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>        closedTasks <span class="op">=</span> <span class="va">self</span>.stock(<span class="st">"closedTasks"</span>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>        staff <span class="op">=</span> <span class="va">self</span>.stock(<span class="st">"staff"</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Flows</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>        completionRate <span class="op">=</span> <span class="va">self</span>.flow(<span class="st">"completionRate"</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Converters</span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>        currentTime <span class="op">=</span> <span class="va">self</span>.converter(<span class="st">"currentTime"</span>)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>        remainingTime <span class="op">=</span> <span class="va">self</span>.converter(<span class="st">"remainingTime"</span>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>       ...</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Constants</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>        deadline <span class="op">=</span> <span class="va">self</span>.constant(<span class="st">"deadline"</span>)</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>        effortPerTask <span class="op">=</span> <span class="va">self</span>.constant(<span class="st">"effortPerTask"</span>)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Actual Logic</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>        openTasks.initial_value <span class="op">=</span> <span class="fl">100.0</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>        closedTasks.initial_value <span class="op">=</span> <span class="fl">0.0</span>  <span class="co"># not really necessary, but I like to be explicit</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>        ...</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>        completionRate.equation <span class="op">=</span> sd.<span class="bu">max</span>(<span class="fl">0.0</span>, sd.<span class="bu">min</span>(openTasks, staff <span class="op">*</span> (productivity <span class="op">/</span> effortPerTask)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>First, the class’s name has to be <code>simulation_model</code> and inherit from BPTK_Py.Model, as we have done before. The call to the <code>super()._init__</code> function configures the model’s main parameters. And then only the code for your equations follows. Now you are done, the model is defined.</p>
<p>In the next step, we need to write the JSON (the full file is available here: <a href="scenarios/manual.json">scenarios/dsl_class.json</a>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"smSimpleProjectManagementDslClass"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"model"</span><span class="fu">:</span> <span class="st">"simulation_models/simple_project_dsl_class"</span><span class="fu">,</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"base_constants"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"deadline"</span><span class="fu">:</span> <span class="fl">100.0</span><span class="fu">,</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"initialOpenTasks"</span><span class="fu">:</span> <span class="fl">100.0</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"base_points"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"productivity"</span><span class="fu">:</span>  <span class="ot">[</span> <span class="ot">[</span><span class="dv">0</span><span class="ot">,</span><span class="fl">0.4</span><span class="ot">],[</span><span class="fl">0.25</span><span class="ot">,</span><span class="fl">0.444</span><span class="ot">],[</span><span class="fl">0.5</span><span class="ot">,</span><span class="fl">0.506</span><span class="ot">],[</span><span class="fl">0.75</span><span class="ot">,</span><span class="fl">0.594</span><span class="ot">],[</span><span class="dv">1</span><span class="ot">,</span><span class="dv">1</span><span class="ot">],[</span><span class="fl">1.25</span><span class="ot">,</span><span class="fl">1.119</span><span class="ot">],[</span><span class="fl">1.5</span><span class="ot">,</span><span class="fl">1.1625</span><span class="ot">],[</span><span class="fl">1.75</span><span class="ot">,</span><span class="fl">1.2125</span><span class="ot">],[</span><span class="dv">2</span><span class="ot">,</span><span class="fl">1.2375</span><span class="ot">],[</span><span class="fl">2.25</span><span class="ot">,</span><span class="fl">1.245</span><span class="ot">],[</span><span class="fl">2.5</span><span class="ot">,</span><span class="fl">1.25</span><span class="ot">]</span> <span class="ot">]</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">},</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"scenarios"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>      <span class="dt">"scenario100"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"constants"</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>          <span class="dt">"initialOpenTasks"</span><span class="fu">:</span> <span class="fl">100.0</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that this is exactly the structure we used for linking to the generated SD models. As long as the model has an <code>equations</code> and <code>memo</code> field and its name is <code>simulation_model</code>, BPTK-Py is agnostic of the code inside.</p>
<p>We can easily plot the scenario and see that it the same model as we defined interactively:</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> BPTK_Py</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>bptk <span class="op">=</span> BPTK_Py.bptk()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>bptk.plot_scenarios(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    scenarios<span class="op">=</span><span class="st">"scenario80,scenario100,scenario120"</span>,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    scenario_managers<span class="op">=</span><span class="st">"smSimpleProjectManagementDslClass"</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    equations<span class="op">=</span><span class="st">"openTasks"</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    series_names<span class="op">=</span>{</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"smSimpleProjectManagementDSL_scenario80_openTasks"</span>:<span class="st">"scenario80"</span>,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"smSimpleProjectManagementDSL_scenario100_openTasks"</span>:<span class="st">"scenario100"</span>,</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"smSimpleProjectManagementDSL_scenario120_openTasks"</span>:<span class="st">"scenario120"</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="conclusion" class="level3">
<h3 class="anchored" data-anchor-id="conclusion">Conclusion</h3>
<p>This completes our quick tour of the SD DSL within the Business Prototyping Toolkit.</p>
<p>This post introduced a simple domain-specific language for System Dynamics, implemented in Python. It let’s you create System Dynamics in Python and supports interactive modeling in Jupyter.</p>
<p>Creating System Dynamics models directly in Python is particulary useful if you have the need to extend your SD models with your own SD functions or you would like to combine your models with other computational models such as Agent-based models or mathematical models.</p>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../step-by-step-guides/introduction_sd_dsl/introduction_sd_dsl.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Introduction to SD DSL</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../sd-dsl/in-depth/in_depth_sd_dsl_functions/in_depth_sd_dsl_functions.html" class="pagination-link">
        <span class="nav-page-text">SD DSL Functions</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">© Copyright 2022, transentis labs GmbH.</div>
  </div>
</footer>



</body></html>